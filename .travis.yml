sudo: false
dist: trusty
language: php
notifications:
  email:
    on_success: never
    on_failure: change
  slack:
    secure: Ncgw/7mTkdhSZfmVvd9RF5h1M8JyfE0UBeKZAp6NS9s6jm1mSF72GFTsZt2bIeu73cmxWZCxfzQwfZXUk9SoU5U3aOG9Mg5Tp/KEIpd8tqEdmcGg/6pTYhrmrBcq2+aDsx4IGdbf3+7WH2JkRx2ttxWgSUQ7kWOycUpdrazDMx2/482HnTWJLHeg0NNbZaKB9302Ce9j5wy4a4zv0FpbE38IFIQsnPFKTlQaZ1FPB1ngt5xZEp/7axQ7mT+V61hB/lxAUicjsoIqBkxPIPigVXIb/t2eCNetDi9tfvJUZfxjCh1GdYyF6I6PkrySSpvJE0ck3tsxx6q2yT/SfOOCN9rK71u/ApGdda7x9DoXtZky8Q2OLqnr/ht15Dq+mXkbFvdlp/B785FzoQ1WJj+6bhCUVpMDrdUwNpGy9NtC4nRjieZp5oBUsfTDVSB4tQp/FzBNeCbq8XNts0lWMoPwnHegLX3rST7F0omPQuBDf1eZQ5dOkiARC2gjpDvuqkEwFdwZbmjff4u3ODqE8bF+I9x+XgO+ob4tLuVFrnAePxx4dgkt+KzxUdbho9uuisu0RrJnMZ5z3lWngEyjnmzoZA4zgk+W3yKFndw99sF1PcjirTg6igR5Th0Z5EbAEI95Xpha+2Tr/Q2u4zDjf1cTP1mVuS39ufHWnRGsnNgMihE=
branches:
  only:
  - master
  - develop
  - "/v\\d+\\.\\d+\\.\\d+?.*/"
cache:
  directories:
  - node_modules
  - vendor
  - "$HOME/.composer/cache"
before_install:
- nvm install 12
- nvm use 12
node_js:
- stable
- lts/*
matrix:
  include:
  - php: 7.3
    env: WP_VERSION=latest
  - php: 7.3
    env: WP_VERSION=trunk
  - php: 7.3
    env: WP_TRAVISCI=phpcs
  - php: 7.3
    env: WP_TRAVISCI=eslint
  - php: 7.2
    env: WP_VERSION=latest
  - php: 5.6
    env: WP_VERSION=latest
    dist: precise
before_script:
- export PATH="$HOME/.composer/vendor/bin:$PATH"
- |
  if [ -f ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/xdebug.ini ]; then
    phpenv config-rm xdebug.ini
  else
    echo "xdebug.ini does not exist"
  fi
- |
  if [[ ! -z "$WP_VERSION" ]] ; then
    bash bin/install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION
    composer global require "phpunit/phpunit=4.8.*|5.7.*"
  fi
- |
  if [[ "$WP_TRAVISCI" == "phpcs" ]] ; then
    composer global require wp-coding-standards/wpcs
    phpcs --config-set installed_paths $HOME/.composer/vendor/wp-coding-standards/wpcs
  fi
- |
  if [[ "$WP_TRAVISCI" == "eslint" ]] ; then
    npm install
  fi
script:
- |
  if [[ ! -z "$WP_VERSION" ]] ; then
    phpunit
    WP_MULTISITE=1 phpunit
  fi
- |
  if [[ "$WP_TRAVISCI" == "phpcs" ]] ; then
    phpcs --standard=phpcs.ruleset.xml $(find . -name '*.php')
  fi
- |
  if [[ "$WP_TRAVISCI" == "eslint" ]] ; then
    npm run lint-js
  fi
